<!DOCTYPE html>
<html>
<head>
	<title>Broadcast Message</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="//cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="jumbotron col-sm-2 col-lg-2 col-md-1">
				<div id="room"></div>
			</div>
			<div class="jumbotron col-sm-5 col-lg-5 col-md-3">
				<a class="btn btn-primary" style="display: block; width: 100%;margin:10px;" id="start">Start Recording</a>
				<a class="btn btn-primary" style="display: block; width: 100%;margin:10px;" id="stop">Stop Recording and Send</a>
				<a href="home.html" class="btn btn-primary" style="display: block; width: 100%;margin:10px;">Back To Home</a>
			</div>
			<div class="col-sm-3 col-lg-3 col-md-2">
				
			</div>
		</div>		
	</div>
	<script>
		var mediaRecorder;
		var socket = io();
		$('#start').click(function(){
			socket.emit('roomname',"");
			socket.on('room',function(roomName){
				console.log("atlast ",roomName);
			});
			var constraints = { audio: true };
			navigator.mediaDevices.getUserMedia(constraints).then(function(mediaStream) {
		    mediaRecorder = new MediaRecorder(mediaStream);
		    mediaRecorder.onstart = function(e) {
		        this.chunks = [];
		    };
		    mediaRecorder.ondataavailable = function(e) {
		        this.chunks.push(e.data);
		    };
		    mediaRecorder.onstop = function(e) {
		        var blob = new Blob(this.chunks, { 'type' : 'audio/ogg; codecs=opus' });
		        socket.emit('voice', blob);
		    };

		    // Start recording
		    mediaRecorder.start();

			});
		});
		$('#stop').click(function(){
			mediaRecorder.stop();
		});
	</script>
</body>
</html>
	